<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŸ’æ¯“ä¸ªäººé¡µé¢ - æŸ’æ¯“'s Portfolio</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
    <style>
        /* Page Sections */
        .page-section {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        .page-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Settings Panel Styles */
        .settings-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            bottom: 20px; /* Stretch to bottom with margin */
            width: 450px; /* Slightly wider than original 350px/400px */
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 0;
            z-index: 2001;
            transform: translateX(120%); /* Slide from right */
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            box-shadow: -10px 10px 40px rgba(0,0,0,0.5);
            display: flex;
            flex-direction: column;
            opacity: 1; /* Reset opacity from previous change */
            visibility: visible; /* Reset visibility */
        }

        .settings-panel.show {
            transform: translateX(0);
        }

        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.2rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }

        .settings-content {
            padding: 2rem;
            overflow-y: auto;
            flex: 1;
            /* Custom Scrollbar */
            scrollbar-width: thin;
            scrollbar-color: var(--text-secondary) rgba(255, 255, 255, 0.05);
        }

        .settings-content::-webkit-scrollbar {
            width: 8px;
        }

        .settings-content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        .settings-content::-webkit-scrollbar-thumb {
            background-color: var(--text-secondary);
            border-radius: 4px;
        }

        /* Settings Tabs */
        .settings-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.05);
            padding: 0.5rem;
            gap: 0.5rem;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            flex-shrink: 0;
        }

        .settings-tab {
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            color: var(--text-secondary);
            font-size: 0.85rem;
            font-weight: 600;
            white-space: nowrap;
            transition: all 0.2s;
            border: 1px solid transparent;
        }

        .settings-tab:hover {
            color: var(--text-main);
            background: rgba(255, 255, 255, 0.1);
        }

        .settings-tab.active {
            background: var(--text-main);
            color: black;
        }

        .settings-section {
            display: none;
        }

        .settings-section.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        .admin-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 1rem;
        }

        .admin-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            border: 1px solid transparent;
        }

        .admin-item:hover {
            border-color: var(--border-color);
        }

        .admin-item-title {
            color: var(--text-main);
            font-size: 0.9rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .btn-delete {
            background: #ff4444;
            color: white;
            border: none;
            padding: 0.2rem 0.5rem;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8rem;
        }

        .btn-delete:hover {
            background: #cc0000;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .setting-item label {
            color: var(--text-secondary);
            flex: 1;
        }

        .setting-item input[type="color"] {
            border: none;
            width: 40px;
            height: 40px;
            cursor: pointer;
            background: none;
        }

        .setting-item input[type="file"] {
            color: var(--text-secondary);
            font-size: 0.8rem;
            width: 100%;
            margin-top: 0.5rem;
        }

        .admin-section {
            margin-top: 2rem;
            border-top: 1px solid var(--border-color);
            padding-top: 1rem;
        }
        
        .admin-section h4 {
            color: var(--text-main);
            margin-bottom: 1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 0.8rem 1rem;
            background: rgba(255, 255, 255, 0.08);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: white;
            margin-bottom: 1rem;
            font-size: 0.95rem;
            transition: border-color 0.2s;
        }

        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none;
            border-color: var(--text-main);
            background: rgba(255, 255, 255, 0.12);
        }

        .btn-upload {
            background: var(--text-main);
            color: black;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
        }

        :root {
            /* Black & White Starry Theme */
            --bg-color: #000000;
            --card-bg: rgba(20, 20, 20, 0.65);
            --text-main: #ffffff;
            --text-secondary: #a0a0a0;
            --accent-glow: rgba(255, 255, 255, 0.2);
            --border-color: rgba(255, 255, 255, 0.15);
            
            /* Monochrome Accents */
            --accent-white: #ffffff;
            --accent-gray: #888888;
            --accent-silver: #c0c0c0;
            
            /* Shadows for depth in dark mode */
            --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.8);
            --shadow-card: 0 4px 6px rgba(0, 0, 0, 0.5), 0 10px 15px rgba(0, 0, 0, 0.3);
            
            --radius-lg: 24px;
            --radius-md: 16px;
            --radius-pill: 50px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            padding-bottom: 100px;
            overflow-x: hidden;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            transition: background 0.5s ease;
        }

        /* Canvas Particle System */
        #particleCanvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background: radial-gradient(circle at center, rgba(26,26,26,0.8) 0%, rgba(0,0,0,0.9) 100%);
        }

        /* Navigation */
        nav {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(16px);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            z-index: 1000;
            border-bottom: 1px solid var(--border-color);
        }

        .nav-left {
            display: flex;
            align-items: center;
            gap: 2rem;
        }

        .brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 800;
            font-size: 1.2rem;
            color: var(--text-main);
            text-decoration: none;
            font-family: 'Orbitron', sans-serif;
            letter-spacing: 1px;
        }

        .brand-logo {
            width: 32px;
            height: 32px;
            background: var(--text-main);
            color: black;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: 900;
        }

        .nav-items {
            display: flex;
            gap: 0.5rem;
        }

        .nav-link {
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 600;
            padding: 0.5rem 1.2rem;
            border-radius: var(--radius-pill);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.4rem;
            font-size: 0.95rem;
            border: 1px solid transparent;
        }

        .nav-link:hover {
            color: var(--text-main);
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .nav-link.active {
            background: var(--text-main);
            color: black;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
        }

        .nav-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 1px solid var(--border-color);
            background: rgba(255, 255, 255, 0.05);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
        }

        .icon-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            color: var(--text-main);
            border-color: var(--text-main);
        }

        .icon-btn.music-active {
            background: var(--text-main);
            color: black;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .user-avatar-sm {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--text-main);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        /* Layout */
        .container {
            max-width: 1400px;
            margin: 100px auto 0;
            padding: 0 1.5rem;
            display: grid;
            grid-template-columns: 350px 1fr; /* 350px Sidebar + Rest */
            gap: 2rem;
            align-items: start;
        }

        /* Left Sidebar Styles */
        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            position: sticky;
            top: 90px;
            height: calc(100vh - 120px);
            overflow-y: auto;
            scrollbar-width: none; /* Hide scrollbar Firefox */
        }
        
        .sidebar::-webkit-scrollbar {
            display: none; /* Hide scrollbar Chrome/Safari */
        }

        .profile-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 2rem 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: var(--shadow-soft);
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .profile-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin-bottom: 1rem;
            border: 4px solid var(--text-main);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.2);
            object-fit: cover;
        }

        .profile-name {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--text-main);
            margin-bottom: 0.5rem;
            font-family: 'Orbitron', sans-serif;
        }

        .profile-badge {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-main);
            padding: 0.3rem 1rem;
            border-radius: var(--radius-pill);
            font-size: 0.8rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .profile-bio {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .social-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            justify-content: center;
        }

        .social-btn {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-main);
            font-size: 1.1rem;
            text-decoration: none;
            transition: all 0.2s;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.3);
        }

        .social-btn:hover {
            transform: translateY(-3px);
            background: var(--text-main);
            color: black;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);
        }

        .skills-section {
            width: 100%;
            text-align: left;
            margin-bottom: 2rem;
        }

        .skills-title, .tools-title {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            margin-bottom: 0.8rem;
            font-weight: 700;
        }

        .skills-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .skill-chip {
            background: transparent;
            color: var(--text-main);
            padding: 0.3rem 0.8rem;
            border-radius: 8px;
            font-size: 0.8rem;
            font-weight: 600;
            border: 1px solid rgba(255, 255, 255, 0.3);
            transition: all 0.3s;
        }
        
        .skill-chip:hover {
            background: var(--text-main);
            color: black;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        /* Tools Section */
        .tools-section {
            width: 100%;
            text-align: left;
            margin-bottom: 5rem; /* Space for music player */
        }

        .tools-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .tool-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.8rem;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.2s;
        }

        .tool-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .tool-icon {
            font-size: 1.2rem;
            color: var(--text-main);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .tool-details h4 {
            font-size: 0.9rem;
            color: var(--text-main);
            margin-bottom: 0.2rem;
        }

        .tool-details p {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        /* Fixed Music Player in Sidebar */
        .music-player-fixed {
            position: absolute;
            bottom: 1.5rem;
            left: 1.5rem;
            right: 1.5rem;
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 1rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.3);
            backdrop-filter: blur(10px);
        }

        .player-info-mini {
            display: flex;
            flex-direction: column;
        }

        .player-title {
            font-size: 0.85rem;
            font-weight: 700;
            color: var(--text-main);
        }

        .player-status {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }

        .player-btn-mini {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: var(--text-main);
            color: black;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .player-btn-mini:hover {
            transform: scale(1.1);
        }

        /* Right Content */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        /* Hero Card */
        .hero-card {
            background: var(--card-bg);
            border-radius: var(--radius-lg);
            padding: 3rem;
            box-shadow: var(--shadow-soft);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(10px);
        }

        .hero-greeting {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-main);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-family: 'Orbitron', sans-serif;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .hero-text {
            color: var(--text-secondary);
            font-size: 1.1rem;
            max-width: 600px;
            margin-bottom: 2rem;
            line-height: 1.8;
        }

        .hero-actions {
            display: flex;
            gap: 1rem;
        }

        .btn {
            padding: 0.8rem 1.8rem;
            border-radius: var(--radius-pill);
            font-weight: 700;
            text-decoration: none;
            transition: all 0.3s ease;
            border: 1px solid transparent;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-primary {
            background: var(--text-main);
            color: black;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.4);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 0 25px rgba(255, 255, 255, 0.6);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-main);
            border: 1px solid var(--text-main);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        /* Section Header */
        .section-header {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            margin-bottom: 1rem;
        }

        .section-tag {
            width: 4px;
            height: 24px;
            background: var(--text-main);
            border-radius: 4px;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
        }

        .section-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--text-main);
            letter-spacing: 1px;
            font-family: 'Orbitron', sans-serif;
        }

        /* Projects Grid */
        .projects-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
        }

        .project-card {
            background: var(--card-bg);
            border-radius: var(--radius-md);
            padding: 1.5rem;
            height: auto; /* Allow flexible height but constrained by grid */
            min-height: 240px;
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Align to top */
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-card);
            text-decoration: none;
            color: inherit;
            border: 1px solid var(--border-color);
            backdrop-filter: blur(5px);
        }

        .project-card:hover {
            transform: translateY(-5px);
            border-color: var(--text-main);
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.15);
        }

        .project-icon-wrapper {
            width: 50px; /* Slightly smaller */
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50%;
            border: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .project-info h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            color: var(--text-main);
            line-height: 1.4;
        }

        .project-info p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.6;
            
            /* Line Clamping for Description */
            display: -webkit-box;
            -webkit-line-clamp: 3; /* Limit to 3 lines */
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 1rem;
        }

        .category-pill {
            display: inline-block;
            padding: 0.25rem 0.8rem;
            border-radius: var(--radius-pill);
            font-size: 0.75rem;
            font-weight: 700;
            color: black;
            margin-top: auto; /* Push to bottom if flex space allows */
            align-self: flex-start;
            background: var(--text-main);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .media-preview {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 8px;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .container {
                grid-template-columns: 1fr;
                margin-top: 80px; /* Less top margin on mobile */
                padding: 0 1rem;
            }
            
            .sidebar {
                position: relative;
                top: 0;
                height: auto;
                overflow: visible;
                order: -1;
            }

            .profile-card {
                padding: 1.5rem 1rem;
            }
            
            .projects-grid {
                grid-template-columns: 1fr;
            }

            .music-player-fixed {
                position: fixed;
                bottom: 20px;
                left: 1rem;
                right: 1rem;
                z-index: 999;
                width: auto;
                background: rgba(0, 0, 0, 0.95);
            }

            /* Mobile Navigation */
            nav {
                padding: 0 1rem;
                height: 60px;
                flex-wrap: wrap;
            }

            .nav-left {
                width: 100%;
                justify-content: space-between;
                gap: 0;
            }

            .brand {
                font-size: 1rem;
            }

            .nav-items {
                position: fixed;
                top: 60px;
                left: 0;
                right: 0;
                background: rgba(0, 0, 0, 0.95);
                padding: 0.5rem 1rem;
                overflow-x: auto;
                white-space: nowrap;
                -webkit-overflow-scrolling: touch;
                border-bottom: 1px solid var(--border-color);
                gap: 0.5rem;
                display: flex;
                z-index: 1000;
            }

            .nav-items::-webkit-scrollbar {
                display: none;
            }

            .nav-link {
                padding: 0.4rem 0.8rem;
                font-size: 0.85rem;
                flex-shrink: 0;
            }

            .nav-right {
                position: absolute;
                top: 10px;
                right: 1rem;
            }

            /* Adjust Hero Text */
            .hero-greeting {
                font-size: 1.8rem;
            }

            .hero-text {
                font-size: 1rem;
            }

            /* Mobile Settings Panel */
            .settings-panel {
                width: 100%;
                right: 0;
                top: 0;
                bottom: 0;
                border-radius: 0;
                transform: translateX(100%);
            }
            
            /* Fix Content Overlap with Double Nav */
            .container {
                margin-top: 120px; /* 60px Nav + ~50px Menu Bar + gap */
            }
        }
    </style>
</head>
<body>

    <canvas id="particleCanvas"></canvas>
    <audio id="bgMusic" loop></audio>

    <!-- Navigation -->
    <nav>
        <div class="nav-left">
            <a href="#" class="brand">
                <div class="brand-logo">æŸ’</div>
                æŸ’æ¯“ä¸ªäººé¡µé¢
            </a>
            <div class="nav-items">
                <a href="#" class="nav-link active" data-target="home"><i class="fas fa-home"></i> é¦–é¡µ</a>
                <a href="#" class="nav-link" data-target="works"><i class="fas fa-layer-group"></i> ä½œå“</a>
                <a href="#" class="nav-link" data-target="videos"><i class="fas fa-video"></i> è§†é¢‘</a>
                <a href="#" class="nav-link" data-target="photos"><i class="fas fa-image"></i> å›¾åƒ</a>
                <a href="#" class="nav-link" data-target="tools"><i class="fas fa-tools"></i> å·¥å…·</a>
                <a href="#" class="nav-link" data-target="articles"><i class="fas fa-pen-nib"></i> æ–‡ç« </a>
            </div>
        </div>
        <div class="nav-right">
            <button class="icon-btn music-active" id="musicToggleBtn"><i class="fas fa-music"></i></button>
            <button class="icon-btn" id="settingsToggleBtn"><i class="fas fa-cog"></i></button>
            <img src="ä¸ªäººå¡é€šå›¾åƒ.jpg" alt="Profile" class="user-avatar-sm">
        </div>
    </nav>

    <!-- Password Modal (Sidebar Style) -->
    <div id="passwordModal" class="settings-panel" style="z-index: 2002; height: auto; bottom: auto;">
        <div class="settings-header">
            <h3>Admin Access</h3>
            <button class="close-btn" id="closePasswordModal"><i class="fas fa-times"></i></button>
        </div>
        <div class="settings-content" style="padding: 2rem;">
            <div class="form-group">
                <input type="password" id="adminPasswordInput" placeholder="Enter Password" style="margin-bottom: 1.5rem;">
                <button class="btn-upload" onclick="verifyPassword()" style="width:100%; padding: 1rem;">Unlock Settings</button>
                <p id="passwordError" style="color:#ff4444; font-size:0.9rem; margin-top:1rem; display:none; text-align: center;">Incorrect Password</p>
            </div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h3>è®¾ç½®</h3>
            <button class="close-btn" id="closeSettingsBtn"><i class="fas fa-times"></i></button>
        </div>
        
        <div class="settings-tabs">
            <div class="settings-tab active" data-tab="general">é€šç”¨</div>
            <div class="settings-tab" data-tab="projects">ä½œå“</div>
            <div class="settings-tab" data-tab="media">åª’ä½“</div>
            <div class="settings-tab" data-tab="tools">å·¥å…·</div>
            <div class="settings-tab" data-tab="articles">æ–‡ç« </div>
            <div class="settings-tab" data-tab="deploy" style="color: #4ade80;">å‘å¸ƒ</div>
        </div>

        <div class="settings-content">
            <!-- General Settings -->
            <div class="settings-section active" id="tab-general">
                <div class="setting-item">
                    <label>èƒŒæ™¯é¢œè‰²</label>
                    <input type="color" id="bgColorInput" value="#000000">
                </div>
                <div class="setting-item">
                    <label>èƒŒæ™¯å›¾ç‰‡</label>
                    <input type="file" id="bgImageInput" accept="image/*">
                </div>
                <div class="setting-item">
                    <label>èƒŒæ™¯éŸ³ä¹</label>
                    <input type="file" id="bgMusicInput" accept="audio/*">
                </div>
            </div>

            <!-- Projects Settings -->
            <div class="settings-section" id="tab-projects">
                <div class="admin-section" style="margin-top:0; border-top:none;">
                    <h4>æ·»åŠ åº”ç”¨ (ä½œå“)</h4>
                    <div class="form-group">
                        <input type="text" id="projTitle" placeholder="åº”ç”¨åç§°">
                        <input type="text" id="projDesc" placeholder="ç®€çŸ­æè¿°">
                        <input type="text" id="projLink" placeholder="é“¾æ¥åœ°å€">
                        <input type="text" id="projCategory" placeholder="åˆ†ç±» (e.g. Web App)">
                        <label style="color:var(--text-secondary); font-size:0.9rem; display:block; margin-bottom:0.5rem;">ä¸Šä¼ å›¾æ ‡ (å¯é€‰)</label>
                        <input type="file" id="projIconInput" accept="image/*">
                        <button class="btn-upload" onclick="uploadProject()">æ·»åŠ åº”ç”¨</button>
                    </div>
                </div>
                <div class="admin-section">
                    <h4>ç®¡ç†ä½œå“</h4>
                    <div id="adminProjectsList" class="admin-list"></div>
                </div>
            </div>

            <!-- Media Settings -->
            <div class="settings-section" id="tab-media">
                <div class="admin-section" style="margin-top:0; border-top:none;">
                    <h4>ä¸Šä¼ åª’ä½“ (è§†é¢‘/å›¾åƒ)</h4>
                    <div class="form-group">
                        <select id="mediaType">
                            <option value="video">è§†é¢‘</option>
                            <option value="image">å›¾åƒ</option>
                        </select>
                        <input type="text" id="mediaTitle" placeholder="æ ‡é¢˜">
                        <input type="file" id="mediaFileInput">
                        <button class="btn-upload" onclick="uploadMedia()">ä¸Šä¼ </button>
                    </div>
                </div>
                <div class="admin-section">
                    <h4>ç®¡ç†åª’ä½“</h4>
                    <div id="adminMediaList" class="admin-list"></div>
                </div>
            </div>

            <!-- Tools Settings -->
            <div class="settings-section" id="tab-tools">
                <div class="admin-section" style="margin-top:0; border-top:none;">
                    <h4>æ·»åŠ å·¥å…·</h4>
                    <div class="form-group">
                        <input type="text" id="toolName" placeholder="å·¥å…·åç§° (e.g. VS Code)">
                        <input type="text" id="toolDesc" placeholder="æè¿°">
                        <input type="text" id="toolLink" placeholder="å·¥å…·é“¾æ¥ (å¯é€‰)">
                        <label style="color:var(--text-secondary); font-size:0.9rem; display:block; margin-bottom:0.5rem;">ä¸Šä¼ å›¾æ ‡ (å¯é€‰)</label>
                        <input type="file" id="toolIconInput" accept="image/*">
                        <button class="btn-upload" onclick="addTool()">æ·»åŠ å·¥å…·</button>
                    </div>
                </div>
                <div class="admin-section">
                    <h4>ç®¡ç†å·¥å…·</h4>
                    <div id="adminToolsList" class="admin-list"></div>
                </div>
            </div>

            <!-- Articles Settings -->
            <div class="settings-section" id="tab-articles">
                <div class="admin-section" style="margin-top:0; border-top:none;">
                    <h4>å‘å¸ƒæ–‡ç« </h4>
                    <div class="form-group">
                        <input type="text" id="articleTitle" placeholder="æ–‡ç« æ ‡é¢˜">
                        <textarea id="articleSummary" rows="3" placeholder="æ–‡ç« æ‘˜è¦..."></textarea>
                        <input type="text" id="articleLink" placeholder="æ–‡ç« é“¾æ¥ (å¯é€‰)">
                        <input type="text" id="articleCategory" placeholder="åˆ†ç±» (e.g. Tech)">
                        <button class="btn-upload" onclick="addArticle()">å‘å¸ƒæ–‡ç« </button>
                    </div>
                </div>
                <div class="admin-section">
                    <h4>ç®¡ç†æ–‡ç« </h4>
                    <div id="adminArticlesList" class="admin-list"></div>
                </div>
            </div>

            <!-- Deploy Settings -->
            <div class="settings-section" id="tab-deploy">
                <div class="admin-section" style="margin-top:0; border-top:none; text-align:center;">
                    <h4>åŒæ­¥å‘å¸ƒåˆ°äº‘ç«¯</h4>
                    <p style="color:var(--text-secondary); font-size:0.9rem; margin-bottom:1.5rem;">
                        <b>æœ¬åœ°å¼€å‘æ—¶ï¼š</b> å°†æœ¬åœ°çš„æ‰€æœ‰ä¿®æ”¹åŒæ­¥åˆ° GitHub ä»“åº“ã€‚<br>
                        <b>çº¿ä¸Šè®¿é—®æ—¶ï¼š</b> ä¸éœ€è¦ç‚¹å‡»æ­¤æŒ‰é’®ã€‚æ‰€æœ‰ä¿®æ”¹ä¼šè‡ªåŠ¨ä¿å­˜å¹¶è§¦å‘æ›´æ–°ï¼ˆçº¦1-2åˆ†é’Ÿç”Ÿæ•ˆï¼‰ã€‚
                    </p>
                    <div id="sync-proxy-config" style="margin-bottom: 1rem; background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px;">
                        <label style="display: block; margin-bottom: 0.5rem; font-size: 0.85rem; color: var(--text-secondary);">
                            <i class="fas fa-network-wired"></i> Git ä»£ç†è®¾ç½® (å¯é€‰)
                        </label>
                        <div style="display: flex; gap: 10px;">
                            <input type="text" id="gitProxyInput" placeholder="ä¾‹å¦‚: 127.0.0.1:7890" 
                                   style="flex: 1; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; padding: 5px 10px; color: white; font-size: 0.9rem;">
                            <button onclick="saveProxy()" style="background: rgba(255,255,255,0.1); border: none; padding: 5px 15px; border-radius: 4px; color: white; cursor: pointer; font-size: 0.85rem;">ä¿å­˜</button>
                        </div>
                        <p style="font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.5rem;">
                            * å¦‚æœåŒæ­¥ä¸€ç›´å¤±è´¥ï¼Œè¯·å¡«å…¥æ‚¨çš„ VPN ä»£ç†åœ°å€ã€‚
                        </p>
                    </div>
                    <button class="btn-upload" onclick="deployToCloud()" id="deployBtn" style="background: #4ade80; color: black; font-size:1.1rem; padding:1rem;">
                        <i class="fas fa-cloud-upload-alt"></i> ç«‹å³åŒæ­¥å‘å¸ƒ
                    </button>
                    <div id="deployLog" style="margin-top:1.5rem; text-align:left; font-family:monospace; font-size:0.85rem; color:#a0a0a0; background:rgba(0,0,0,0.3); padding:1rem; border-radius:4px; display:none; white-space: pre-wrap;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="profile-card">
                <img src="ä¸ªäººå¡é€šå›¾åƒ.jpg" alt="æŸ’æ¯“ Avatar" class="profile-avatar">
                <h2 class="profile-name">æŸ’æ¯“</h2>
                <span class="profile-badge">è‡ªåŠ¨åŒ–ç©å®¶</span>
                
                <p class="profile-bio">
                    çƒ­è¡·äºåˆ›æ„å­˜é‡ï¼Œæ¸©æš–çš„äº¤äº’ä½“éªŒã€‚<br>
                    n8n|æ‰£å­Agent|vibe coding
                </p>
                
                <div class="social-row">
                    <a href="#" class="social-btn"><i class="fab fa-github"></i></a>
                    <a href="#" class="social-btn"><i class="fab fa-twitter"></i></a>
                    <a href="#" class="social-btn"><i class="fas fa-envelope"></i></a>
                </div>

                <div class="skills-section">
                    <div class="skills-title">SKILLSET</div>
                    <div class="skills-list">
                        <span class="skill-chip">Agent</span>
                        <span class="skill-chip">n8n</span>
                        <span class="skill-chip">RPA</span>
                        <span class="skill-chip">Python</span>
                        <span class="skill-chip">vibe coding</span>
                    </div>
                </div>

                <div class="tools-section">
                    <div class="tools-title">RECOMMENDED TOOLS</div>
                    <div class="tools-list">
                        <div class="tool-item">
                            <div class="tool-icon"><i class="fas fa-code"></i></div>
                            <div class="tool-details">
                                <h4>VS Code</h4>
                                <p>æœ€å¼ºä»£ç ç¼–è¾‘å™¨</p>
                            </div>
                        </div>
                        <div class="tool-item">
                            <div class="tool-icon"><i class="fab fa-figma"></i></div>
                            <div class="tool-details">
                                <h4>Figma</h4>
                                <p>UI è®¾è®¡åˆ©å™¨</p>
                            </div>
                        </div>
                        <div class="tool-item">
                            <div class="tool-icon"><i class="fas fa-robot"></i></div>
                            <div class="tool-details">
                                <h4>ChatGPT</h4>
                                <p>AI ç”Ÿäº§åŠ›åŠ©æ‰‹</p>
                            </div>
                        </div>
                        <div class="tool-item">
                            <div class="tool-icon"><i class="fab fa-chrome"></i></div>
                            <div class="tool-details">
                                <h4>Chrome</h4>
                                <p>Web å¼€å‘è°ƒè¯•</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Fixed Music Player inside Sidebar -->
                <div class="music-player-fixed">
                    <div class="player-info-mini">
                        <span class="player-title" id="playerTitle">No Music</span>
                        <span class="player-status" id="playerStatus">Paused</span>
                    </div>
                    <button class="player-btn-mini play-btn" id="sidebarPlayBtn"><i class="fas fa-play"></i></button>
                </div>
            </div>
        </aside>

        <!-- Right Content (Main) -->
        <main class="main-content">
            
            <!-- Home Section -->
            <div id="section-home" class="page-section active">
                <div class="hero-card">
                    <div class="hero-greeting">
                        ä½ å¥½ï¼Œæˆ‘æ˜¯æŸ’æ¯“! <span style="font-size: 2rem;">ğŸ‘‹</span>
                    </div>
                    <p class="hero-text">
                        æ¬¢è¿æ¥åˆ°æˆ‘çš„æ˜Ÿç©ºé£æ ¼ä¸ªäººä¸»é¡µã€‚è¿™é‡Œå±•ç¤ºäº†æˆ‘çš„è®¾è®¡ä½œå“ã€å¼€å‘é¡¹ç›®ä»¥åŠæˆ‘å–œæ¬¢çš„éŸ³ä¹å’Œè§†é¢‘ã€‚
                    </p>
                    <div class="hero-actions">
                        <a href="#" class="btn btn-primary" onclick="document.querySelector('[data-target=works]').click()">æµè§ˆä½œå“ â†’</a>
                        <a href="#" class="btn btn-secondary" onclick="document.getElementById('settingsToggleBtn').click()">ä¸ªæ€§åŒ–è®¾ç½®</a>
                    </div>
                </div>

                <div style="margin-top: 2rem;">
                    <div class="section-header">
                        <div class="section-tag"></div>
                        <h2 class="section-title">ç²¾é€‰ä½œå“</h2>
                    </div>
                    <div class="projects-grid" id="homeProjectsGrid">
                        <!-- Loaded dynamically -->
                    </div>
                </div>
            </div>

            <!-- Works Section -->
            <div id="section-works" class="page-section">
                <div class="section-header">
                    <div class="section-tag"></div>
                    <h2 class="section-title">å…¨éƒ¨ä½œå“</h2>
                </div>
                <div class="projects-grid" id="worksGrid">
                    <!-- Loaded dynamically -->
                </div>
            </div>

            <!-- Videos Section -->
            <div id="section-videos" class="page-section">
                <div class="section-header">
                    <div class="section-tag"></div>
                    <h2 class="section-title">è§†é¢‘åˆ›ä½œ</h2>
                </div>
                <div class="projects-grid" id="videosGrid">
                    <!-- Loaded dynamically -->
                </div>
            </div>

            <!-- Photos Section -->
            <div id="section-photos" class="page-section">
                <div class="section-header">
                    <div class="section-tag"></div>
                    <h2 class="section-title">æˆ‘çš„å›¾åƒ</h2>
                </div>
                <div class="projects-grid" id="photosGrid">
                    <!-- Loaded dynamically -->
                </div>
            </div>

            <!-- Tools Section (Static for now, can be dynamic too) -->
            <div id="section-tools" class="page-section">
                <div class="section-header">
                    <div class="section-tag"></div>
                    <h2 class="section-title">å¸¸ç”¨å·¥å…·æ¸…å•</h2>
                </div>
                <div class="hero-card" style="margin-bottom: 2rem;">
                    <div style="text-align: center;">
                        <div style="width: 60px; height: 60px; background: #333; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1rem;">
                            <i class="fas fa-wrench" style="color: #fff; font-size: 1.5rem;"></i>
                        </div>
                        <h3 style="color: var(--text-main); margin-bottom: 0.5rem;">å¸¸ç”¨å·¥å…·æ¸…å•</h3>
                        <p style="color: var(--text-secondary);">è¿™é‡Œåˆ—å‡ºäº†æˆ‘æ—¥å¸¸å¼€å‘å’Œè®¾è®¡ä½¿ç”¨çš„é«˜æ•ˆå·¥å…·ã€‚</p>
                    </div>
                </div>
                <div class="projects-grid">
                    <div class="project-card">
                        <div class="project-icon-wrapper"><i class="fas fa-code"></i></div>
                        <h3>VS Code</h3>
                        <p>æœ€å¼ºä»£ç ç¼–è¾‘å™¨</p>
                        <span class="category-pill">Dev</span>
                    </div>
                    <div class="project-card">
                        <div class="project-icon-wrapper"><i class="fab fa-figma"></i></div>
                        <h3>Figma</h3>
                        <p>UI è®¾è®¡åˆ©å™¨</p>
                        <span class="category-pill">Design</span>
                    </div>
                </div>
            </div>

            <!-- Articles Section -->
            <div id="section-articles" class="page-section">
                <div class="section-header">
                    <div class="section-tag"></div>
                    <h2 class="section-title">æœ€æ–°æ–‡ç« </h2>
                </div>
                <div class="projects-grid">
                    <div class="project-card">
                        <div class="project-icon-wrapper">ğŸ“</div>
                        <h3>Hello World</h3>
                        <p>è¿™æ˜¯æˆ‘çš„ç¬¬ä¸€ç¯‡åšå®¢æ–‡ç« ...</p>
                        <span class="category-pill">Blog</span>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <script>
        // Use relative path for production (Vercel) compatibility
        const API_URL = '/api';

        // --- Data Fetching ---
        async function fetchData() {
            try {
                const res = await fetch(`${API_URL}/data`);
                const data = await res.json();
                
                applySettings(data.settings);
                renderProjects(data.projects);
                renderMedia(data.media);
                renderTools(data.tools);
                renderArticles(data.articles);

                // Render Admin Lists
                renderAdminList('adminProjectsList', data.projects, 'projects');
                renderAdminList('adminMediaList', data.media, 'media');
                renderAdminList('adminToolsList', data.tools, 'tools');
                renderAdminList('adminArticlesList', data.articles, 'articles');
            } catch (err) {
                console.error('Failed to fetch data:', err);
            }
        }

        function renderAdminList(elementId, items, type) {
            const container = document.getElementById(elementId);
            if (!container) return;

            if (!items || items.length === 0) {
                container.innerHTML = '<p style="color:var(--text-secondary); font-size:0.8rem;">No items yet.</p>';
                return;
            }

            container.innerHTML = items.map(item => `
                <div class="admin-item">
                    <span class="admin-item-title">${item.title || item.name}</span>
                    <button class="btn-delete" onclick="deleteItem('${type}', ${item.id})">Delete</button>
                </div>
            `).join('');
        }

        async function deleteItem(type, id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            
            try {
                await fetch(`${API_URL}/${type}/${id}`, { method: 'DELETE' });
                fetchData(); // Refresh all lists
            } catch (err) {
                console.error('Failed to delete:', err);
                alert('Failed to delete item.');
            }
        }

        function applySettings(settings) {
            if (settings.backgroundColor) {
                document.documentElement.style.setProperty('--bg-color', settings.backgroundColor);
                document.getElementById('bgColorInput').value = settings.backgroundColor;
            }
            if (settings.backgroundImage) {
                document.body.style.backgroundImage = `url(${settings.backgroundImage})`;
            }
            if (settings.backgroundMusic) {
                const audio = document.getElementById('bgMusic');
                audio.src = settings.backgroundMusic;
                document.getElementById('playerTitle').textContent = "Background Music";
            }
        }

        function renderProjects(projects) {
            const html = (projects || []).map(p => `
                <a href="${p.link || '#'}" class="project-card" target="_blank">
                    <div class="project-icon-wrapper">
                         ${p.iconUrl ? `<img src="${p.iconUrl}" style="width:100%; height:100%; object-fit:cover; border-radius:50%;">` : '<i class="fas fa-layer-group"></i>'}
                    </div>
                    <div class="project-info">
                        <h3>${p.title}</h3>
                        <p>${p.description}</p>
                    </div>
                    <span class="category-pill">${p.category}</span>
                </a>
            `).join('');
            
            document.getElementById('worksGrid').innerHTML = html;
            // Show first 2 on home
            document.getElementById('homeProjectsGrid').innerHTML = html;
        }

        function renderMedia(mediaList) {
            const videos = (mediaList || []).filter(m => m.type === 'video');
            const images = (mediaList || []).filter(m => m.type === 'image');

            document.getElementById('videosGrid').innerHTML = videos.map(v => `
                <div class="project-card" style="height: auto;">
                    <video src="${v.url}" controls style="width:100%; border-radius:8px;"></video>
                    <h3 style="color:var(--text-main); margin-top:0.5rem;">${v.title}</h3>
                </div>
            `).join('') || '<p style="color:#888; text-align:center;">æš‚æ— è§†é¢‘</p>';

            document.getElementById('photosGrid').innerHTML = images.map(img => `
                <div class="project-card" style="height: auto;">
                    <img src="${img.url}" class="media-preview" onclick="window.open(this.src)">
                    <h3 style="color:var(--text-main); margin-top:0.5rem;">${img.title}</h3>
                </div>
            `).join('') || '<p style="color:#888; text-align:center;">æš‚æ— å›¾ç‰‡</p>';
        }

        function renderTools(tools) {
            // Render grid cards for the Tools Section in main content.
            const gridHtml = (tools || []).map(t => `
                <div class="project-card" ${t.link ? `onclick="window.open('${t.link}', '_blank')" style="cursor:pointer;"` : ''}>
                    <div class="project-icon-wrapper">
                        ${t.iconUrl ? `<img src="${t.iconUrl}" style="width:100%; height:100%; object-fit:cover; border-radius:50%;">` : `<i class="${t.icon || 'fas fa-wrench'}"></i>`}
                    </div>
                    <h3>${t.name}</h3>
                    <p>${t.description}</p>
                    <span class="category-pill">Tool</span>
                </div>
            `).join('');
            
            // If we want to replace the static content in #section-tools .projects-grid
            const toolsGrid = document.querySelector('#section-tools .projects-grid');
            if(toolsGrid) toolsGrid.innerHTML = gridHtml || '<p style="color:#888;">æš‚æ— å·¥å…·</p>';
        }

        function renderArticles(articles) {
            const html = (articles || []).map(a => `
                <div class="project-card" onclick="window.open('${a.link || '#'}', '_blank')">
                    <div class="project-icon-wrapper">ğŸ“</div>
                    <h3>${a.title}</h3>
                    <p>${a.summary}</p>
                    <span class="category-pill">${a.category || 'Blog'}</span>
                </div>
            `).join('');
            
            const articlesGrid = document.querySelector('#section-articles .projects-grid');
            if(articlesGrid) articlesGrid.innerHTML = html || '<p style="color:#888;">æš‚æ— æ–‡ç« </p>';
        }

        // --- Admin Actions ---
        
        // Change Background Color
        document.getElementById('bgColorInput').addEventListener('change', async (e) => {
            const color = e.target.value;
            document.documentElement.style.setProperty('--bg-color', color);
            await fetch(`${API_URL}/settings`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ backgroundColor: color })
            });
        });

        // Upload Background Image
        document.getElementById('bgImageInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            const formData = new FormData();
            formData.append('file', file);
            
            const res = await fetch(`${API_URL}/upload/background`, { method: 'POST', body: formData });
            const data = await res.json();
            document.body.style.backgroundImage = `url(${data.url})`;
        });

        // Upload Music
        document.getElementById('bgMusicInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;

            // Check file size (limit to 4MB for Vercel/GitHub compatibility)
            if (file.size > 4 * 1024 * 1024) {
                alert('æ–‡ä»¶è¿‡å¤§ï¼è¯·ä¸Šä¼ å°äº 4MB çš„éŸ³é¢‘æ–‡ä»¶ã€‚');
                e.target.value = ''; // Clear input
                return;
            }

            // Show loading state
            const label = e.target.previousElementSibling;
            const originalText = label.textContent;
            label.textContent = 'èƒŒæ™¯éŸ³ä¹ (æ­£åœ¨ä¸Šä¼ ...)';
            e.target.disabled = true;

            const formData = new FormData();
            formData.append('file', file);
            
            try {
                const res = await fetch(`${API_URL}/upload/music`, { method: 'POST', body: formData });
                if (!res.ok) throw new Error('Upload failed');
                
                const data = await res.json();
                const audio = document.getElementById('bgMusic');
                audio.src = data.url;
                document.getElementById('playerTitle').textContent = file.name.replace(/\.[^/.]+$/, ""); // Remove extension
                
                // Try to auto-play
                try {
                    await audio.play();
                    document.getElementById('playerStatus').textContent = "Playing...";
                    document.getElementById('sidebarPlayBtn').innerHTML = '<i class="fas fa-pause"></i>';
                    document.getElementById('musicToggleBtn').classList.add('music-active');
                } catch (err) {
                    console.log("Auto-play blocked, user interaction required");
                }

                alert('èƒŒæ™¯éŸ³ä¹ä¸Šä¼ æˆåŠŸï¼');
            } catch (err) {
                console.error(err);
                alert('ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•ã€‚');
            } finally {
                // Reset UI
                label.textContent = originalText;
                e.target.disabled = false;
            }
        });

        // Upload Project
        async function uploadProject() {
            const formData = new FormData();
            formData.append('title', document.getElementById('projTitle').value);
            formData.append('description', document.getElementById('projDesc').value);
            formData.append('link', document.getElementById('projLink').value);
            formData.append('category', document.getElementById('projCategory').value);
            
            const iconFile = document.getElementById('projIconInput').files[0];
            if (iconFile) {
                formData.append('icon', iconFile);
            }
            
            await fetch(`${API_URL}/projects`, {
                method: 'POST',
                body: formData
            });
            alert('åº”ç”¨æ·»åŠ æˆåŠŸï¼åˆ·æ–°é¡µé¢æŸ¥çœ‹ã€‚');
            fetchData();
        }

        // Upload Media
        async function uploadMedia() {
            const fileInput = document.getElementById('mediaFileInput');
            const file = fileInput.files[0];
            if (!file) return alert('è¯·é€‰æ‹©æ–‡ä»¶');

            const formData = new FormData();
            formData.append('file', file);
            formData.append('type', document.getElementById('mediaType').value);
            formData.append('title', document.getElementById('mediaTitle').value);

            await fetch(`${API_URL}/upload/media`, { method: 'POST', body: formData });
            alert('ä¸Šä¼ æˆåŠŸï¼åˆ·æ–°é¡µé¢æŸ¥çœ‹ã€‚');
            fetchData();
        }

        // Add Tool
        async function addTool() {
            const formData = new FormData();
            formData.append('name', document.getElementById('toolName').value);
            formData.append('description', document.getElementById('toolDesc').value);
            formData.append('link', document.getElementById('toolLink').value);
            
            const iconFile = document.getElementById('toolIconInput').files[0];
            if (iconFile) {
                formData.append('icon', iconFile);
            }
            
            await fetch(`${API_URL}/tools`, {
                method: 'POST',
                body: formData
            });
            alert('å·¥å…·æ·»åŠ æˆåŠŸï¼');
            fetchData();
        }

        // Add Article
        async function addArticle() {
            const article = {
                title: document.getElementById('articleTitle').value,
                summary: document.getElementById('articleSummary').value,
                link: document.getElementById('articleLink').value,
                category: document.getElementById('articleCategory').value
            };
            
            await fetch(`${API_URL}/articles`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(article)
            });
            alert('æ–‡ç« å‘å¸ƒæˆåŠŸï¼');
            fetchData();
        }

        // Deploy to Cloud
        function saveProxy() {
            const proxy = document.getElementById('gitProxyInput').value;
            localStorage.setItem('git_proxy', proxy);
            alert('ä»£ç†è®¾ç½®å·²ä¿å­˜ï¼åŒæ­¥æ—¶å°†å°è¯•ä½¿ç”¨æ­¤ä»£ç†ã€‚');
        }

        async function deployToCloud() {
            const btn = document.getElementById('deployBtn');
            const log = document.getElementById('deployLog');
            const proxy = localStorage.getItem('git_proxy');
            
            if (!confirm('ç¡®å®šè¦åŒæ­¥æ‰€æœ‰æœ¬åœ°ä¿®æ”¹åˆ°äº‘ç«¯å¹¶å‘å¸ƒå—ï¼Ÿ')) return;

            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> æ­£åœ¨åŒæ­¥å‘å¸ƒä¸­...';
            log.style.display = 'block';
            log.textContent = '> å¼€å§‹åŒæ­¥è¿›ç¨‹...\n> æ­£åœ¨æ‰§è¡Œ Git Add/Commit/Push...';
            log.style.color = '#a0a0a0';

            try {
                const res = await fetch(`${API_URL}/deploy`, { 
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ proxy: proxy })
                });
                const data = await res.json();

                if (data.success) {
                    log.textContent += '\n> ' + data.message;
                    log.textContent += '\n> æˆåŠŸï¼Vercel æ­£åœ¨è‡ªåŠ¨æ„å»ºä¸Šçº¿ã€‚';
                    log.style.color = '#4ade80';
                    alert('å‘å¸ƒæˆåŠŸï¼Vercel æ­£åœ¨åå°æ›´æ–°ï¼Œè¯·ç¨å€™è®¿é—®çº¿ä¸Šé“¾æ¥ã€‚');
                } else {
                    log.textContent += '\n> é”™è¯¯: ' + data.error;
                    if (data.details) log.textContent += '\n' + data.details;
                    log.style.color = '#ff4444';
                }
            } catch (err) {
                log.textContent += '\n> è¯·æ±‚å¤±è´¥: ' + err.message;
                log.style.color = '#ff4444';
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-cloud-upload-alt"></i> ç«‹å³åŒæ­¥å‘å¸ƒ';
            }
        }

        // Initialize Proxy UI
        document.addEventListener('DOMContentLoaded', () => {
            const savedProxy = localStorage.getItem('git_proxy');
            if (savedProxy && document.getElementById('gitProxyInput')) {
                document.getElementById('gitProxyInput').value = savedProxy;
            }
        });


        // --- UI Interactions ---

        // Settings Panel Logic
        const settingsBtn = document.getElementById('settingsToggleBtn');
        const settingsPanel = document.getElementById('settingsPanel');
        const closeSettingsBtn = document.getElementById('closeSettingsBtn');
        const passwordModal = document.getElementById('passwordModal');
        const closePasswordModalBtn = document.getElementById('closePasswordModal');

        // Verify Password Logic
        async function verifyPassword() {
            const password = document.getElementById('adminPasswordInput').value;
            try {
                const res = await fetch(`${API_URL}/verify-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ password })
                });
                const data = await res.json();
                
                if (data.success) {
                    passwordModal.classList.remove('show');
                    passwordModal.style.display = 'none';
                    // Use setTimeout to allow UI update
                    setTimeout(() => {
                        settingsPanel.style.display = 'flex'; // Ensure it's visible
                        // Force reflow
                        void settingsPanel.offsetWidth;
                        settingsPanel.classList.add('show');
                    }, 50);
                    
                    document.getElementById('adminPasswordInput').value = ''; // Clear password
                    document.getElementById('passwordError').style.display = 'none';
                } else {
                    document.getElementById('passwordError').style.display = 'block';
                }
            } catch (err) {
                console.error('Verify failed', err);
            }
        }

        // Open Password Modal instead of Settings Panel
        settingsBtn.addEventListener('click', () => {
            // Check if already open
            if (settingsPanel.classList.contains('show')) {
                settingsPanel.classList.remove('show');
                setTimeout(() => { settingsPanel.style.display = 'none'; }, 300); // Wait for transition
            } else {
                // Ensure settings panel is hidden
                settingsPanel.classList.remove('show');
                settingsPanel.style.display = 'none';
                
                // Show Password Modal
                passwordModal.style.display = 'flex';
                // Small timeout to allow display:block to apply before adding class (if we had transition)
                setTimeout(() => { passwordModal.classList.add('show'); }, 10);
            }
        });

        // Close Password Modal
        closePasswordModalBtn.addEventListener('click', () => {
            passwordModal.classList.remove('show');
            setTimeout(() => { passwordModal.style.display = 'none'; }, 300);
        });

        closeSettingsBtn.addEventListener('click', () => {
            settingsPanel.classList.remove('show');
            setTimeout(() => { settingsPanel.style.display = 'none'; }, 300);
        });

        // Settings Tabs Logic
        document.querySelectorAll('.settings-tab').forEach(tab => {
            tab.addEventListener('click', () => {
                // Remove active class from all tabs
                document.querySelectorAll('.settings-tab').forEach(t => t.classList.remove('active'));
                // Add active class to clicked tab
                tab.classList.add('active');
                
                // Hide all sections
                document.querySelectorAll('.settings-section').forEach(s => s.classList.remove('active'));
                // Show target section
                const targetId = tab.getAttribute('data-tab');
                document.getElementById(`tab-${targetId}`).classList.add('active');
            });
        });

        // Tab Switching Logic
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                link.classList.add('active');
                
                const targetId = link.getAttribute('data-target');
                document.querySelectorAll('.page-section').forEach(section => {
                    section.classList.remove('active');
                });
                
                const targetSection = document.getElementById(`section-${targetId}`);
                if (targetSection) {
                    targetSection.classList.add('active');
                }
            });
        });

        // Music Player Controls
        const bgMusic = document.getElementById('bgMusic');
        const sidebarPlayBtn = document.getElementById('sidebarPlayBtn');
        const topMusicBtn = document.getElementById('musicToggleBtn');
        const playerStatus = document.getElementById('playerStatus');

        function togglePlay() {
            if (bgMusic.paused) {
                bgMusic.play().catch(e => console.log("Audio play failed interaction required"));
                playerStatus.textContent = "Playing...";
                sidebarPlayBtn.innerHTML = '<i class="fas fa-pause"></i>';
                topMusicBtn.classList.add('music-active');
            } else {
                bgMusic.pause();
                playerStatus.textContent = "Paused";
                sidebarPlayBtn.innerHTML = '<i class="fas fa-play"></i>';
                topMusicBtn.classList.remove('music-active');
            }
        }

        sidebarPlayBtn.addEventListener('click', togglePlay);
        topMusicBtn.addEventListener('click', togglePlay);


        // --- Starry Mouse Trail ---
        class StarryMouseTrail {
            constructor() {
                this.canvas = document.createElement('canvas');
                this.ctx = this.canvas.getContext('2d');
                this.canvas.style.position = 'fixed';
                this.canvas.style.top = '0';
                this.canvas.style.left = '0';
                this.canvas.style.width = '100%';
                this.canvas.style.height = '100%';
                this.canvas.style.pointerEvents = 'none';
                this.canvas.style.zIndex = '9999';
                document.body.appendChild(this.canvas);
                
                this.particles = [];
                this.colors = ['#FFFFFF', '#F0F8FF', '#E0FFFF', '#B0C4DE']; 
                this.resize();
                
                window.addEventListener('resize', () => this.resize());
                window.addEventListener('mousemove', (e) => this.spawn(e.clientX, e.clientY));
                
                this.animate();
            }
            
            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }
            
            spawn(x, y) {
                for(let i = 0; i < 3; i++) {
                    this.particles.push({
                        x: x,
                        y: y,
                        vx: (Math.random() - 0.5) * 2,
                        vy: (Math.random() - 0.5) * 2,
                        size: Math.random() * 3 + 1,
                        color: this.colors[Math.floor(Math.random() * this.colors.length)],
                        life: 1,
                        decay: 0.01 + Math.random() * 0.02,
                        rotation: Math.random() * Math.PI * 2,
                        rotationSpeed: (Math.random() - 0.5) * 0.1,
                        shape: Math.random() > 0.3 ? 'star' : 'dust'
                    });
                }
            }
            
            drawStar(x, y, r, color, rotation, opacity) {
                this.ctx.save();
                this.ctx.translate(x, y);
                this.ctx.rotate(rotation);
                this.ctx.beginPath();
                this.ctx.fillStyle = color;
                this.ctx.shadowBlur = 10;
                this.ctx.shadowColor = color;
                
                for (let i = 0; i < 4; i++) {
                    this.ctx.lineTo(Math.cos((0 + i * 90) * Math.PI / 180) * r, 
                                  -Math.sin((0 + i * 90) * Math.PI / 180) * r);
                    this.ctx.lineTo(Math.cos((45 + i * 90) * Math.PI / 180) * (r * 0.2), 
                                  -Math.sin((45 + i * 90) * Math.PI / 180) * (r * 0.2));
                }
                this.ctx.closePath();
                this.ctx.fill();
                this.ctx.restore();
            }

            drawDust(x, y, r, color) {
                this.ctx.beginPath();
                this.ctx.arc(x, y, r, 0, Math.PI * 2);
                this.ctx.fillStyle = color;
                this.ctx.shadowBlur = 5;
                this.ctx.shadowColor = color;
                this.ctx.fill();
            }
            
            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                for (let i = 0; i < this.particles.length; i++) {
                    const p = this.particles[i];
                    p.x += p.vx;
                    p.y += p.vy;
                    p.life -= p.decay;
                    p.rotation += p.rotationSpeed;
                    
                    if (p.life > 0) {
                        this.ctx.globalAlpha = p.life;
                        if (p.shape === 'star') {
                            this.drawStar(p.x, p.y, p.size * 2, p.color, p.rotation, p.life);
                        } else {
                            this.drawDust(p.x, p.y, p.size, p.color);
                        }
                    }
                }
                this.ctx.globalAlpha = 1;
                this.particles = this.particles.filter(p => p.life > 0);
                requestAnimationFrame(() => this.animate());
            }
        }
        
        // Initialize Starry Mouse Trail
        new StarryMouseTrail();

        // Particle System (Background)
        class ParticleSystem {
            constructor() {
                this.canvas = document.getElementById('particleCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.particles = [];
                this.resize();
                
                window.addEventListener('resize', () => this.resize());
                this.initParticles();
                this.animate();
            }

            resize() {
                this.canvas.width = window.innerWidth;
                this.canvas.height = window.innerHeight;
            }

            initParticles() {
                this.particles = [];
                const count = window.innerWidth < 768 ? 50 : 150; 
                for (let i = 0; i < count; i++) {
                    this.particles.push(new Particle(this.canvas));
                }
            }

            animate() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                this.ctx.strokeStyle = 'rgba(255, 255, 255, 0.05)';
                this.ctx.lineWidth = 0.5;
                
                for(let i = 0; i < this.particles.length; i++) {
                    const p1 = this.particles[i];
                    p1.update();
                    p1.draw(this.ctx);
                    
                    for(let j = i + 1; j < this.particles.length; j++) {
                        const p2 = this.particles[j];
                        const dx = p1.x - p2.x;
                        const dy = p1.y - p2.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        if (distance < 100) {
                            this.ctx.beginPath();
                            this.ctx.moveTo(p1.x, p1.y);
                            this.ctx.lineTo(p2.x, p2.y);
                            this.ctx.stroke();
                        }
                    }
                }
                requestAnimationFrame(() => this.animate());
            }
        }

        class Particle {
            constructor(canvas) {
                this.canvas = canvas;
                this.x = Math.random() * this.canvas.width;
                this.y = Math.random() * this.canvas.height;
                this.vx = (Math.random() - 0.5) * 0.5;
                this.vy = (Math.random() - 0.5) * 0.5;
                this.size = Math.random() * 2 + 0.5;
            }

            update() {
                this.x += this.vx;
                this.y += this.vy;
                if (this.x < 0 || this.x > this.canvas.width) this.vx *= -1;
                if (this.y < 0 || this.y > this.canvas.height) this.vy *= -1;
            }

            draw(ctx) {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
                ctx.fill();
            }
        }

        new ParticleSystem();

        // Initial Fetch
        fetchData();
    </script>
    <!-- Chat Widget -->
    <div id="chat-widget-container">
        <!-- Chat Button -->
        <button id="chat-toggle-btn" class="chat-fab">
            <i class="fas fa-robot"></i>
        </button>

        <!-- Chat Window -->
        <div id="chat-window" class="chat-window hidden">
            <div id="chat-header" class="chat-header">
                <span><i class="fas fa-robot"></i> æŸ’æ¯“ (AI)</span>
                <div class="chat-controls">
                    <button id="chat-close-btn"><i class="fas fa-times"></i></button>
                </div>
            </div>
            <div id="chat-messages" class="chat-messages">
                <!-- Messages will appear here -->
                <div class="message bot-message">ä½ å¥½ï¼æˆ‘æ˜¯æŸ’æ¯“ã€‚æ¬¢è¿æ¥åˆ°æˆ‘çš„ä¸ªäººä¸»é¡µï¼Œæœ‰ä»€ä¹ˆæˆ‘å¯ä»¥å¸®ä½ çš„å—ï¼Ÿ</div>
            </div>
            <div class="chat-input-area">
                <input type="text" id="chat-input" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜..." autocomplete="off">
                <button id="chat-send-btn"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <style>
        /* Chat Widget Styles */
        #chat-widget-container {
            position: fixed;
            bottom: 30px;
            right: 30px;
            z-index: 9999;
            font-family: 'Inter', sans-serif;
        }

        /* Floating Action Button */
        .chat-fab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: white;
            border: none;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
            font-size: 24px;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .chat-fab:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.6);
        }

        /* Chat Window */
        .chat-window {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            height: 500px;
            background: rgba(20, 20, 20, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: opacity 0.3s, transform 0.3s;
            opacity: 1;
            transform: translateY(0);
        }

        .chat-window.hidden {
            opacity: 0;
            transform: translateY(20px);
            pointer-events: none;
            display: none; /* Fully hide to prevent clicks */
        }

        /* Header (Draggable) */
        .chat-header {
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: move; /* Drag cursor */
            color: white;
            font-weight: 600;
        }

        .chat-controls button {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            font-size: 16px;
        }

        .chat-controls button:hover {
            color: white;
        }

        /* Messages Area */
        .chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .message {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 0.95rem;
            line-height: 1.5;
            word-wrap: break-word;
        }

        .bot-message {
            align-self: flex-start;
            background: rgba(255, 255, 255, 0.1);
            color: #e5e5e5;
            border-bottom-left-radius: 2px;
        }

        .user-message {
            align-self: flex-end;
            background: #4ade80;
            color: #000;
            border-bottom-right-radius: 2px;
        }

        /* Typewriter Cursor */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s step-start infinite;
        }

        @keyframes blink {
            50% { opacity: 0; }
        }

        /* Input Area */
        .chat-input-area {
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            gap: 10px;
        }

        #chat-input {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 10px 15px;
            color: white;
            outline: none;
        }

        #chat-input:focus {
            border-color: #4ade80;
        }

        #chat-send-btn {
            background: none;
            border: none;
            color: #4ade80;
            font-size: 20px;
            cursor: pointer;
            padding: 0 10px;
        }

        #chat-send-btn:hover {
            color: #22c55e;
            transform: scale(1.1);
        }

        /* Mobile Responsive */
        @media (max-width: 600px) {
            .chat-window {
                width: 100%;
                height: 100%;
                bottom: 0;
                right: 0;
                border-radius: 0;
                top: 0; /* Full screen */
            }
            
            .chat-header {
                cursor: default; /* Disable drag on mobile */
            }
            
            #chat-widget-container {
                /* Reset container pos for full screen */
                bottom: 0;
                right: 0;
                left: 0;
                top: 0;
                pointer-events: none; /* Let clicks pass through when hidden */
                width: 100%;
                height: 100%;
            }
            
            #chat-toggle-btn {
                position: absolute;
                bottom: 20px;
                right: 20px;
                pointer-events: auto; /* Re-enable pointer events for FAB */
            }

            .chat-window:not(.hidden) {
                pointer-events: auto;
            }
        }
    </style>

    <script>
        // Chat Widget Logic
        const chatWidget = {
            isOpen: false,
            history: [], // Conversation history
            
            init() {
                this.cacheDOM();
                this.bindEvents();
                this.makeDraggable();
            },

            cacheDOM() {
                this.container = document.getElementById('chat-widget-container');
                this.btn = document.getElementById('chat-toggle-btn');
                this.window = document.getElementById('chat-window');
                this.closeBtn = document.getElementById('chat-close-btn');
                this.messages = document.getElementById('chat-messages');
                this.input = document.getElementById('chat-input');
                this.sendBtn = document.getElementById('chat-send-btn');
                this.header = document.getElementById('chat-header');
            },

            bindEvents() {
                this.btn.addEventListener('click', () => this.toggleChat());
                this.closeBtn.addEventListener('click', () => this.toggleChat());
                this.sendBtn.addEventListener('click', () => this.sendMessage());
                this.input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.sendMessage();
                });
            },

            toggleChat() {
                this.isOpen = !this.isOpen;
                if (this.isOpen) {
                    this.window.classList.remove('hidden');
                    this.btn.style.display = 'none'; // Hide FAB when open
                    this.scrollToBottom();
                    this.logEvent('chat_opened');
                } else {
                    this.window.classList.add('hidden');
                    this.btn.style.display = 'flex';
                }
            },

            async sendMessage() {
                const text = this.input.value.trim();
                if (!text) return;

                // User Message
                this.appendMessage('user', text);
                this.input.value = '';
                this.history.push({ role: 'user', content: text });

                // Loading State
                const loadingId = this.appendLoading();

                try {
                    const res = await fetch('/api/chat', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            message: text,
                            history: this.history.slice(-10) // Keep last 10 turns context
                        })
                    });
                    
                    const data = await res.json();
                    
                    // Remove loading
                    this.removeMessage(loadingId);
                    
                    // Bot Message with Typewriter
                    this.typeWriter(data.reply);
                    this.history.push({ role: 'assistant', content: data.reply });
                    this.logEvent('message_sent');

                } catch (err) {
                    console.error(err);
                    this.removeMessage(loadingId);
                    this.appendMessage('bot', 'æŠ±æ­‰ï¼Œç½‘ç»œå‡ºäº†ç‚¹å°å·®é”™ï¼Œè¯·ç¨åå†è¯•ã€‚');
                }
            },

            appendMessage(role, text) {
                const div = document.createElement('div');
                div.className = `message ${role}-message`;
                div.textContent = text;
                this.messages.appendChild(div);
                this.scrollToBottom();
                return div;
            },

            appendLoading() {
                const div = document.createElement('div');
                div.className = 'message bot-message';
                div.innerHTML = '<i class="fas fa-ellipsis-h fa-fade"></i>'; // FontAwesome loading
                div.id = 'msg-' + Date.now();
                this.messages.appendChild(div);
                this.scrollToBottom();
                return div.id;
            },

            removeMessage(id) {
                const el = document.getElementById(id);
                if (el) el.remove();
            },

            typeWriter(text) {
                const div = document.createElement('div');
                div.className = 'message bot-message typing-cursor';
                this.messages.appendChild(div);
                this.scrollToBottom();

                let i = 0;
                const speed = 30; // ms per char

                const type = () => {
                    if (i < text.length) {
                        div.textContent += text.charAt(i);
                        i++;
                        this.scrollToBottom();
                        setTimeout(type, speed);
                    } else {
                        div.classList.remove('typing-cursor');
                    }
                };
                type();
            },

            scrollToBottom() {
                this.messages.scrollTop = this.messages.scrollHeight;
            },

            makeDraggable() {
                // Only on desktop
                if (window.innerWidth <= 600) return;

                let isDragging = false;
                let currentX;
                let currentY;
                let initialX;
                let initialY;
                let xOffset = 0;
                let yOffset = 0;

                const dragStart = (e) => {
                    initialX = e.clientX - xOffset;
                    initialY = e.clientY - yOffset;

                    if (e.target === this.header || this.header.contains(e.target)) {
                        isDragging = true;
                    }
                };

                const dragEnd = () => {
                    initialX = currentX;
                    initialY = currentY;
                    isDragging = false;
                };

                const drag = (e) => {
                    if (isDragging) {
                        e.preventDefault();
                        currentX = e.clientX - initialX;
                        currentY = e.clientY - initialY;

                        xOffset = currentX;
                        yOffset = currentY;

                        setTranslate(currentX, currentY, this.window);
                    }
                };

                const setTranslate = (xPos, yPos, el) => {
                    el.style.transform = `translate3d(${xPos}px, ${yPos}px, 0)`;
                };

                this.header.addEventListener("mousedown", dragStart);
                document.addEventListener("mouseup", dragEnd);
                document.addEventListener("mousemove", drag);
            },
            
            logEvent(eventName) {
                // Placeholder for Analytics (A/B Testing)
                console.log(`[Analytics] Event: ${eventName}`);
                // Example: gtag('event', eventName, { ... });
            }
        };

        // Initialize when DOM loaded
        document.addEventListener('DOMContentLoaded', () => {
            chatWidget.init();
        });
    </script>
</body>
</html>